---
title: Linux文件权限
categories: Linux
tags: Linux命令
---

* content
{:toc}


## 普通权限
### 概念

* 对文件：
  * r： 读取
  * w： 写入
  * x： 可执行

* 对目录：
  * r： 能够ls浏览此目录内容
  * w： 能够执行 rm/mv/cp/mkdir/touch/等更改目录内容的操作
  * x： 能够cd切换到此目录



### chmod

`chmod` 命令用于改变文件的权限。

格式：`chmod options mode file`

* 八进制模式：

  mode为 xxxx 

* 符号模式：

  mode为 [ugoa] [+-=] [rwxXstugo]



### chown

`chown` 命令用于改变文件的所有者或所属组。

```bash
chown -R user:grp test/  #递归地修改目录及其下面内容的所有者和所属组
chown user.grp file      #改变文件的所有者和所属组
chown user. file         #改变文件的所有者和所属组
chown user file          #改变文件的所有者
chown group file         #改变文件的所属组
```

注意： 非root用户可以改变文件的属组，但前提是属主必须是原属组和目标属组的成员。



### chgrp

`chgrp` 命令用于改变文件的所属组。

```bash
chgrp [-R] grp1 test/
```



### umask

默认权限。对文件来说，全权限的值是666；而对目录来说，全权限是777。



## 特殊权限
### SUID
* 作用： 以程序所有者的身份执行程序。

* 表示方法： 属主的x权限用s代替。


### SGID
* 作用：
  * 作用在二进制程序上时，以程序所属者的身份执行程序。
  * 作用于目录上时，此文件夹下所有用户新建文件都自动继承此目录的用户组。

* 表示方法： 所属组的x权限用s代替。


### Sticky
* 作用：
  * 对于一个多人可写的目录，如果设置了sticky，则每个用户仅能删除和改名自己的文件或目录。
  * 进程结束后文件还驻留在内存中。
  * 只能作用在目录上，普通文件设置无意义，且会被linux内核忽略。
  * 用户在设置Sticky权限的目录下新建的目录不会自动继承Sticky权限。


### 总结

1、作用

|        | 二进制文件                | 目录                                          |
| ------ | ------------------------ | --------------------------------------------- |
| SUID   | 用户将继承程序的所有者权限 | 无意义                                         |
| SGID   | 用户将继承程序的所属组权限 | 此目录下所有用户新建文件都自动继承此目录的用户组   |
| Sticky | 无意义                   | 目录中每个用户仅能删除、移动或改名自己的文件或目录 |

2、添加权限

字母权限法：

```bash
chmod u+s ...   # 添加 SUID
chmod g+s ...   # 添加 SGID
chmod +s ...    # 同时添加 SUID 和 SGID
chmod -s ...    # 同时删除 SUID 和 SGID
chmod o+t ...   # 添加 Sticky
chmod +t ...    # 同上
```


数字权限法:
```bash
chmod 0755 FILE
chmod  755 FILE
```

* 数字权限法可以同时删除文件的所有三种超级权限。
* 数字权限法只能删除目录的Sticky，不能删除目录的SUID和SGID。

3、表示方法

* SUID      属主的x权限用 `s` 代替。
* GUID      所属组的x权限用 `s` 代替。
* Sticky    文件other位的x权限用 `t` 代替
* 所有表示为大写字母的权限均为无效(故障)权限，因为缺少了相应的x权限。

参考网站： [特殊权限 SUID、SGID、Sticky](https://www.cnblogs.com/Q--T/p/7864795.html)



## ACL 访问控制列表
ACL 可实现对单一用户设定访问文件的权限。
在目录中新建的子文件或子目录不会继承父目录的 ACL 权限。

### setfacl
`setfacl` 命令用于给指定文件或目录设定 ACL 权限。

```bash
setfacl [-R] -m u:用户名:权限类别 文件  ##添加
setfacl [-R] -m g:组名:权限类别 文件  ##添加
setfacl [-R] -m m:权限类别 文件  ##添加 mask 权限
setfacl -b 文件  ##清空所有策略
setfacl -x u:用户名 文件  ##删除指定策略
setfacl -d -m u:用户名:权限类别 文件  #添加默认ACL权限，即其中新建的子文件能继承父目录的ACL权限
setfacl -k 文件名  #删除默认 ACL 权限
```



### getfacl

`getfacl` 命令用于查看文件的 ACL 权限。
```bash
getfacl 文件名  ##查看策略
```

参考网站： [Linux ACL权限设置](http://c.biancheng.net/view/3132.html)



## 隐藏权限
使用 `chattr` 和 `lsattr` 来设置和查看隐藏权限。大部分隐藏权限只能通过 root 来设置。不同文件系统所能设置的权限不一样。

常用属性：

| 属性 | 功能 |
| ---- | -- |
| a | 对于文件，只能增加文件内容，不能删除或修改内容，也不能删除或重命名该文件；<br/>对于目录，只能在目录中创建和修改文件，不能删除或重命名文件。 |
| i | 对于文件，不能增加、修改或删除文件内容，也不能删除或重命名文件；<br/>对于目录，只能修改目录下文件的内容，不能创建、删除或重命名文件。 |


### chattr
`chattr` 命令用于设置隐藏权限。

设置隐藏权限：

```bash
chattr +a test.sh
```


### lsattr
`lsattr` 命令用于查看隐藏权限。

常用选项：
```bash
  -a    显示隐藏文件和目录
  -d    将目录名像其它文件一样列出，而不是列出它们的内容
  -R    递归列出全部目录的内容
```

参考网站： [Linux chattr and lsattr commands](https://www.computerhope.com/unix/chattr.htm)
