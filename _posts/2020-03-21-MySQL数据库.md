---
title: MySQL数据库学习笔记
categories: 数据库
tags: 笔记 MySQL
---

* content
{:toc}


## 基本操作

### 库管理命令

显示已有库

```
SHOW DATABASES;
```

创建库

```
CREATE DATABASE 库名;
```

删除库

```
DROP DATABASE 库名;
```

使用库

```
USE 库名;
```

显示当前所在库

```
SELECT DATABASE();
```

显示创建库的命令

```
SHOW CREATE DATABASE 库名;
```





### 表管理命令

显示已有表

```
SHOW TABLES;
```

创建表

```bash
CREATE TABLE 库名.表名(
  字段名1 字段类型(宽度) 约束条件，
  字段名2 字段类型(宽度) 约束条件
);

# 约束条件
## NULL  允许为空，默认设置
## NOT NULL  不允许为空
## KEY  索引类型
## AUTO INCREMENT  自增（条件：必需是主键，整型）
## DEFAULT  设置为默认值，默认为NULLV

CREATE TABLE user(
  name char(10) NOT NULL,
  age int(3) DEFAULT 18
);
```

删除表

```
DROP TABLE 表名;
```

修改表结构

```bash
ALTER TABLE 表名 执行动作

# 执行动作
## ADD  添加字段
ALTER TABLE 表名 ADD 字段名 类型(宽度) 约束条件 FIRST;
ALTER TABLE 表名 ADD 字段名 类型(宽度) 约束条件 AFTER 字段名;
## MODIFY  修改字段类型
ALTER TABLE 表名 MODIFY 字段名 类型(宽度) 约束条件;
## CHANGE  修改字段名
ALTER TABLE 表名 CHANGE 原字段名 新字段名 类型(宽度) 约束条件;
## DROP  删除字段
ALTER TABLE 表名 DROP 字段名;
## RENAME  修改表名
ALTER TABLE 表名 RENAME 新表名;
```

重命名表

```
RENAME TABLE old_name TO new_name;
```

查看表结构

```
DESC 表名;    #
DESC 表名\G;  #以列表形式展现
```

复制表

```
CREATE TABLE 新表名 SELECT * FROM 旧表名;
```



### 记录管理命令

查看表记录

```
SELECT * FROM 表名;
SELECT 字段1 FROM 表名 WHERE 条件表达式;
```

插入表记录

```
INSERT INTO 表名 VALUES(值列表);
INSERT INTO 表名 VALUES(值列表),(值列表);
INSERT INTO 表名(字段名列表) VALUES(值列表);
INSERT INTO 表名(字段名列表) VALUES(值列表),(值列表);
INSERT INTO 表1(字段名列表) SELECT 字段名列表 FROM 表2;  # 插入 SELECT 的结果
```

修改表记录

```
UPDATE 表名 SET 字段=值;
UPDATE 表名 SET 字段1=值1,字段2=值2 WHRER 条件表达式;
```

删除表记录

```
DELETE FROM 表名;
DELETE FROM 表名 WHRER 条件表达式;
```



### 匹配条件

数值比较

| 操作符 | 用途           |
| :----- | :------------- |
| =      | 等于           |
| >, >=  | 大于；大于等于 |
| <, <=  | 小于；小于等于 |
| !=     | 不等于         |

```
select * from passwd where uid <= 100;
```

<br>

字符比较

匹配时默认不区分大小写。

| 操作符      | 用途   |
| ----------- | ------ |
| =           | 相等   |
| !=          | 不相等 |
| IS NULL     | 匹配空 |
| IS NOT NULL | 非空   |

```
select * from passwd where name="root";
```

<br>逻辑比较

| 操作符 | 用途       |
| ------ | ---------- |
| OR     | 逻辑或     |
| AND    | 逻辑与     |
| !      | 逻辑非     |
| ()     | 提高优先级 |

```
select * from passwd where uid<10 or uid>1000;
```

<br>

范围匹配

| 操作符                  | 用途      |
| ----------------------- | --------- |
| in (值列表)             | 在        |
| not in (值列表)         | 不在      |
| between 数字1 and 数字2 | 在...之间 |

```
select * from passwd where uid between 10 and 100;
```

<br>

去重显示

```
SELECT DISTINCT shell FROM passwd;
```

DISTINCT 关键字应用于所有列而不仅是前置它的列。

<br>

模糊匹配

格式： `WHERE 字段名 LIKE '通配符'`

`_` 匹配单个字符，`%` 匹配0～N个字符 

```
select * from passwd where name like '____';
```

<br>

正则匹配

格式： `WHERE 字段名 REGEXP '正则表达式'`

正则元字符： `.` `*` `[]` `^` `$` `|` 

<br>

四则运算

`+` `-` `*` `/` `%`

为匹配特殊字符，必须在特殊字符前加 `\\`。

```
select name,age, 2018 - age as syear from user where name="root";
select name,uid,gid,(uid+gid)/2 average from user;   #as 可以省略
update user set age=age+1;
```



拼接字段

`CONCAT()` 函数

```
SELECT CONCAT(name,"'s home is ",home) FROM passwd;
```



文本处理函数

| 函数        | 说明                  |
| ----------- | --------------------- |
| Left()      | 返回字符串左边的字符  |
| Length()    | 返回字符串的长度      |
| Locate()    | 找出字符串的一个子串  |
| Lower()     | 转化为小写            |
| LTrim()     | 去掉左边的空格        |
| Right()     | 返回字符串右边的字符  |
| RTrim()     | 去掉右边的空格        |
| Soundex()   | 返回字符串的SOUNDEX值 |
| SubString() | 返回子串的字符        |
| Upper()     | 转化为大写            |

<br>

日期时间函数





聚集函数

| 类型          | 用途           |
| ------------- | -------------- |
| avg(字段名)   | 统计字段平均值 |
| sum(字段名)   | 统计字段之和   |
| min(字段名)   | 统计字段最小值 |
| max(字段名)   | 统计字段最大值 |
| count(字段名) | 统计字段个数   |

```
SELECT MAX(uid) FROM passwd;
```

<br>

排序

格式：`SQL查询 order by 字段名 [desc]`

```
SELECT * FROM passwd ORDER BY uid,guid;  # 先按uid排序，再按guid排序
SELECT * FROM passwd ORDER BY uid desc;  # 降序
```

<br>

分组

格式：`SQL查询 group by 字段名 [desc]`

```
SELECT shell,COUNT(*) FROM passwd GROUP BY shell;
```

<br>

过滤

格式：`SQL查询 having 条件表达式`

```
SELECT shell,COUNT(*) FROM passwd GROUP BY shell HAVING COUNT(*) > 1;

# 列出具有2个以上、价格为10以上的产品的供应商
SELECT vend_id, COUNT(*) AS num_prods
  FROM products
  WHERE prod_price > 10
  GROUP BY vend_id
  HAVING COUNT(*) > 2;
```

`HAVING` 和 `WHERE` 的区别在于：`WHERE` 过滤行，而`HAVING` 过滤分组。

<br>

限制查询结果显示行数

格式：`SQL查询 limit N` 显示查询结果前N条记录

`SQL查询 limit N,M` 显示指定范围内的查询记录

```
SELECT * FROM passwd LIMIT 3;  #显示查询结果前3条记录
SELECT * FROM passwd LIMIT 2,4;  #从第3条开始，共显示4条
```



## 数据类型

### 数值类型

TINYINT

SMALLINT

MEDIUMINT

INT

BIGINT

FLOAT(总宽度, 小数位数)

DOUBLE

DECIMAL



### 字符类型

CHAR(字符数)

VARCHAR(字符数)



### 日期时间类型

DATETIME

TIMESTAMP

DATE

YEAR

TIME



### 枚举类型

ENUM(值1,值2,值3)  单选

SET(值1,值2,值3)  多选



## MySQL索引

### 普通索引

建表时指定索引字段

```
CREATE TABLE table1(
  id int not null,
  name char(10) not null,
  age int(3) not null,
  gender ENUM("male", "female") default "male",
  INDEX(id), INDEX(name)
);
```

在已有表中设置索引字段

```
CREATE INDEX 索引名 ON 表名(字段名);
```

删除指定表的索引字段

```
DROP INDEX 索引名 ON 表名;
```

查看表的索引信息

```
SHOW INDEX FROM 表名;
```



### 主键

建表时指定主键字段

```
CREATE TABLE table1(
  id int not null,
  name char(10) not null,
  age int(3) not null,
  gender ENUM("male", "female") default "male",
  PRIMARY KEY(id)
);
```

在已有表中设置主键字段

```
ALTER TABLE 表名 ADD PRIMARY KEY(字段名);
```

创建复合主键

```
ALTER TABLE 表名 ADD PRIMARY KEY(字段名1,字段名2);
```

删除指定表的主键字段

```
ALTER TABLE 表名 DROP PRIMARY KEY;
```



### 外键

`外键` 让当前表字段的值在另一个表中字段值的范围内选择。

基本用法：

```
FOREIGN KEY(表A的字段名)
  REFERENCES 表B(字段名)
  ON UPDATE CASCADE
  ON DELETE CASCADE
```

建表时指定主键字段

```
CREATE TABLE gzb(
gz_id int (2),
name char(15),
department char(20),
pay float(7,2),
foreign key(gz_id) references ygb(yg_id)
on update cascade
on delete cascade
)engine=innodb;
```

在已有表中设置主键字段

```
ALTER TABLE table1 ADD CONSTRAINT fk_table1_user FOREIGN KEY(id) REFERENCES user(id) on update cascade on delete cascade;
```

删除外键字段

```
ALTER TABLE 表名 DROP FOREIGN KEY 约束名;
```

![MySQL_foreign_key_constrant](/images/database/MySQL_foreign_key_constrant.png)



## 数据导入导出

### 数据导入

查看默认导入目录（只有在该目录中的文件才能导入数据库）：

```
mysql> show variables like "secure_file_priv";
+------------------+-----------------------+
| Variable_name    | Value                 |
+------------------+-----------------------+
| secure_file_priv | /var/lib/mysql-files/ |
+------------------+-----------------------+
1 row in set (0.00 sec)
```

基本用法：

```
LOAD DATA INFILE "目录名/文件名"
  INTO TABLE 表名
  FIELDS TERMINATED BY "分隔符"
  LINES TERMINATED BY "\n";
```



### 数据导出

```
SQL查询 INTO OUTFILE "目录名/文件名"
  FIELDS TERMINATED BY "分隔符"
  LINES TERMINATED BY "\n";
```



## 多表查询

### 子查询

将内层查询结果作为外层查询的查询条件

```
select 字段名 from 表名 where 条件
  (select 字段名 from 表名 where 条件);
```

```
select * from user where age < (select avg(age) from user);
```



### 交叉连接

没有指定匹配条件时，将生成笛卡尔积（查询结果总数目 = 表a的记录数 x 表b的记录数）

格式：`select 字段名列表 from 表a,表b`

```
SELECT * FROM user,de WHERE de.id = user.de_id;
```



### 内连接

格式：`select 字段名列表 from 表1 inner join 表2 on 条件(表1.字段=表2.字段)`

```
SELECT * FROM user INNER JOIN de ON user.de_id = de.id;
```

使用 `ON` 子句而不是 `WHERE` 子句来指定条件。



### 左外连接

优先显示左表全部记录

格式：`select 字段名列表 from 表1 left join 表2 on 条件(表1.字段=表2.字段)`

```
select * from user left join de on user.de_id = de.id;
```



### 右外连接

优先显示右表全部记录

格式：`select 字段名列表 from 表1 right join 表2 on 条件(表1.字段=表2.字段)`

```
select * from user right join de on user.de_id = de.id;
```



### 全外连接

显示左右两个表全部记录

```
select * from 表1 left join 表2 on 条件((表1.字段=表2.字段))
  union
  select * from 表1 right join 表2 on 条件((表1.字段=表2.字段));
```

`UNION` 组合多个查询结果，与 `WHERE` 类似。

`UNION` 默认从查询结果中自动去除重复行。如果想保留所有行，则要使用 `UNION ALL`。



## 视图

### 创建视图

```
CREATE VIEW 视图名 AS
  SELECT 字段名 FROM 表名
```







## 设置密码

### 初始密码



### 重置密码

```
mysqladmin -hlocalhost -uroot -p password "新密码"
```

4 种



### 忘记密码

1、修改配置文件 `/etc/my.cnf`，配置文件可以能是 `/etc/mysql/my.cnf`

在 `[mysqld]` 下一行加上

```
skip-grant-tables
```

2、重启 mysql

CentOS

```
systemctl restart mysqld
```

3、登录并修改密码

```
# mysql -uroot
use mysql;
update user set authentication_string=password('新密码') where user='root' and host='localhost';
flush privileges;
quit;
```

4、将配置文件改回来



5、重启 mysql



## 用户授权

### 创建授权

基本用法

