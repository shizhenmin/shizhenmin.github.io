---
title: Zabbix 二进制包安装
categories: zabbix
tags: 软件安装
---

* content
{:toc}

## 安装服务端

### 1、配置仓库

**a. 配置 Zabbix 镜像仓库**

```bash
rpm -Uvh https://repo.zabbix.com/zabbix/4.4/rhel/7/x86_64/zabbix-release-4.4-1.el7.noarch.rpm
```

上述命令会在 `/etc/yum.repos.d/` 目录下创建 `zabbix.repo` 文件。



**b. 配置浙大镜像仓库**

在 `/etc/yum.repos.d/` 目录下创建 `zju.repo` 文件，写入以下内容：

> [base]
> name=CentOS-$releasever - Base
> baseurl=http://mirrors.zju.edu.cn/centos/7/os/x86_64/
> gpgcheck=1
> gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-CentOS-7
>
> [updates]
> name=CentOS-$releasever - Updates
> baseurl=http://mirrors.zju.edu.cn/centos/7/os/x86_64/
> gpgcheck=1
> gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-CentOS-7
>
> [extras]
> name=CentOS-$releasever - Extras
> baseurl=http://mirrors.zju.edu.cn/centos/7/os/x86_64/
> gpgcheck=1
> gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-CentOS-7



### 2、安装zabbix

需要安装zabbix的服务端，前端，客户端：

```bash
yum -y install zabbix-server-mysql zabbix-web-mysql zabbix-agent
```



### 3、安装配置mysql数据库

**a. 安装mysql数据库**

```bash
yum -y install mariadb mariadb-server mariadb-devel
```



**b. 启动mysql服务**

```bash
systemctl start mariadb
systemctl status mariadb
systemctl enable mariadb
```



**c. 创建数据库**

```
# mysql
mysql> create database zabbix character set utf8 collate utf8_bin;
mysql> grant all privileges on zabbix.* to zabbix@localhost identified by 'zabbix';
mysql> quit; 
```

创建名为 `zabbix` 的数据库，使其支持中文字符集；创建数据库账户 `zabbix`，密码为 `zabbix` 。



**d. 导入数据库**

```bash
zcat /usr/share/doc/zabbix-server-mysql-4.4.4/create.sql.gz | mysql -uzabbix -pzabbix zabbix
```





### 4、配置httpd

**a. 修改httpd配置文件**

修改时区：

```bash
sed -i 's/# php_value date.timezone Europe\/Riga/php_value date.timezone Asia\/Shanghai/' /etc/httpd/conf.d/zabbix.conf
```



**b. 修改防火墙配置**

```bash
firewall-cmd --set-default-zone=trusted
```



**c. 启动httpd服务**

```bash
systemctl start httpd
systemctl enable httpd
```



### 5、启动配置zabbix

**a. 修改SELinux配置**

SELinux默认会阻止启动`zabbix-server`，需要修改SELinux配置（测试失败）：

```bash
setsebool -P httpd_can_connect_zabbix on  #测试失败
```

或者直接关闭SELinux：

```bash
setenforce 0
sed -i 's/^SELINUX=enforcing/SELINUX=permissive/' /etc/selinux/config
```



**b. 修改配置文件**

服务端需要修改 `/etc/zabbix/zabbix_server.conf` 文件中的数据库主机名与密码：

```bash
sed -i 's/^# DBHost/DBHost/' /usr/local/etc/zabbix_server.conf
sed -i 's/^# DBPassword=/DBPassword=zabbix/' /usr/local/etc/zabbix_server.conf
```

修改后配置如下：

> LogFile=/tmp/zabbix_server.log
> DBHost=localhost
> DBName=zabbix
> DBUser=zabbix
> DBPassword=zabbix
> Timeout=4
> LogSlowQueries=3000
> StatsAllowedIP=127.0.0.1



客户端需要修改 `/etc/zabbix/zabbix_agentd.conf` 文件中：

```bash
sed -i 's/^Hostname=.*/Hostname=zabbix_server/' /usr/local/etc/zabbix_agentd.conf
sed -i 's/# UnsafeUserParameters=0/UnsafeUserParameters=1/' /usr/local/etc/zabbix_agentd.conf
```

修改后配置如下：

> LogFile=/tmp/zabbix_agentd.log
> Server=127.0.0.1
> ServerActive=127.0.0.1
> Hostname=zabbix_server
> UnsafeUserParameters=1



**c. 启动zabbix**

```bash
systemctl start zabbix-server zabbix-agent
systemctl enable zabbix-server zabbix-agent
```



**d. 配置zabbix前端**

访问 http://server_ip_or_name/zabbix



![Zabbix_Install_web_01](/images/Zabbix_Install_web_01.png)

![Zabbix_Install_web_01](/images/Zabbix_Install_web_02.png)

![Zabbix_Install_web_01](/images/Zabbix_Install_web_03.png)

![Zabbix_Install_web_01](/images/Zabbix_Install_web_04.png)

![Zabbix_Install_web_01](/images/Zabbix_Install_web_05.png)

![Zabbix_Install_web_01](/images/Zabbix_Install_web_06.png)

![Zabbix_Install_web_01](/images/Zabbix_Install_web_07.png)



## 安装客户端

### 1、配置仓库

需要配置 Zabbix 镜像仓库，具体见服务端安装的部分。



### 2、安装zabbix客户端

如果是安装客户端，只需要安装`zabbix-agent`即可，mysql和httpd等配置都可以跳过：

```bash
yum -y install zabbix-agent
```



### 3、修改配置文件

客户端需要修改 `/etc/zabbix/zabbix_agentd.conf` 文件中：

> Server=192.168.11.131        #被动监控模式
> ServerActive=192.168.11.131  #主动监控模式
> Hostname=zabbix_agent1       #客户端主机名
> EnableRemoteCommands=1       #允许服务器远程执行命令
> UnsafeUserParameters=1       #允许自定义key监控



### 4、启动客户端

```bash
systemctl start zabbix-agent
systemctl status zabbix-agent
```



### 5、服务端监控客户端

客户端安装完成后，需要在web前端添加对客户端的监控。

在 Configuration -> Host 中点击右上角的 Create host 添加需要被监控的主机。

![Zabbix_Install_web_01](/images/Zabbix_Create_host_01.png)

在 Host 这个页面中填写 Host name (需要与客户端zabbix_agentd.conf中的 Hostname 一致)，Groups (点击右边的 Select，随意选择一个Group)，IP address (客户端IP地址)。之后点击左上角 Templates，添加需要关联的监控模板。

![Zabbix_Install_web_01](/images/Zabbix_Create_host_02.png)



