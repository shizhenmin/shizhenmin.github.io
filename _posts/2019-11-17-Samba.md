---
title: Samba服务
categories: Linux
tags: Linux服务
---

* content
{:toc}


## 安装

软件包名：samba【服务端】; samba-client【客户端】

```
yum -y install samba
yum -y install samba-client
```

服务名：smb

```
systemctl restart smb
```

挂载需要安装： cifs-utils

```
yum -y install cifs-utils
```



## 配置文件

/etc/samba/smb.conf：

配置文件可以分成两部分来看，一个是主机信息部分，在 smb.conf 当中以 `[global]`（全局）作为设定的依据；另一个则是分享的信息，以个别的目录名称为依据。

另外有两方面需要注意：

* 井号# 和分号; 都可以用于注释
* 不区分大小写



```
[global]
    workgroup = SAMBA
    security = user
    map to guest = Bad User
[]
    comment = share files with no password
    path = /work/samba_public
    writeable = no
    read only = yes
    browseable = yes
    guest ok = no
```





## 常用命令

### pdbedit



### testparm



### smbclient





## 实例

### 不需要密码的共享

配置不需要账号密码samba共享：

* 共享资源名为 [public]
* 在服务端共享目录 /work/samba_public
* 在客户端将其挂载到 /mnt/samba
* 取消共享 [homes] 目录



1. 准备目录并设置权限：

```
mkdir /work/samba_public -p
chmod 777 -R /work
```



2. 修改配置文件：

```
vim /etc/samba/smb.conf  #
testparm
```



/etc/samba/smb.conf

> [global]
>         workgroup = SAMBA
>         security = user
>         map to guest = Bad User
>
> [public]
>         comment = share files with no password
>         path = /work/samba_public
>         writeable = yes
>         guest ok = yes



3. 重启服务：

```
systemctl restart smb
systemctl enable smb
```



4. 客户端挂载访问：

```
mount -t cifs //192.168.252.11/public /mnt/samba/
```



### 需要账号密码的共享

配置需要账号密码samba共享：

* 密码加密
* 设置3个用户：smb1，smb2，smb3，且均加入 smb_grp 组
* 每个用户拥有自己的家目录
* 共享 /work/samba_share 目录，共享名称为 [share]
* smb_grp 组的成员具有写入的权限



1. 创建账号密码：

```
useradd smb1
useradd smb2
useradd smb3
groupadd smb_grp
gpasswd -a smb1 smb_grp
gpasswd -a smb2 smb_grp
gpasswd -a smb3 smb_grp
pebedit -a smb1
pebedit -a smb2
pebedit -a smb3
```



2. 设置目录权限：

```
mkdir /work/samba_share -p
chown :smb_grp samba_share
chmod 2770 samba_share
```



3. 修改配置文件：

```
vim /etc/samba/smb.conf  #
testparm
```



/etc/samba/smb.conf

> [global]
>        workgroup = SAMBA
>        security = user
>        passdb backend = tdbsam
>
> [homes]
>        comment = Home Directories
>        writeable = yes
>
> [share]
>        comment = smbuser's share
>        path = /work/samba_share
>        writeable = yes
>        write list = @smb_grp



4. 重启服务：

```
systemctl restart smb
systemctl enable smb
```



## 协议与端口