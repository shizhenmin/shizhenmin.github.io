---
title: CentOS 软件包管理
categories: Linux
tags: Linux命令 CentOS
---

* content
{:toc}
## RPM 软件包管理

### RPM 数据库与软件包

RPM 数据库存放当前安装的软件的信息，数据库在 `/var/lib/rpm/` 目录中。

RPM 软件包与 tar 归档文件相似，但还包含一个包头。该包头提供有关软件包的信息和依赖性信息。

RPM默认安装路径：

|  安装路径    |   内 容   |
| ---- | ---- |
| /etc/ | 配置文件安装目录 |
| /usr/bin/ | 可执行程序 |
| /usr/lib/ | 程序所使用的动态函数库 |
| /usr/share/doc/ | 基本的软件使用手册 |
| /usr/share/man/ | 帮助文件 |



### 安装、升级与卸载

常用命令：
```bash
rpm -ivh file.rpm  #安装
rpm -Uvh file.rpm  #将已安装的软件包升级，或新安装最新版的软件包
rpm -Fvh file.rpm  #更新软件包，如果系统上尚未安装该软件，则不会安装最新版软件

rpm -e file.rpm    #卸载
```

rpm 安装命令格式如下:
```bash
rpm -i [query-options] <package_file>
```

安装选项:
```bash
--test          不安装包，只是简单地检查并报告可能的冲突
--nodeps        在安装或升级包之前不做依赖检查
--force         与使用 --replacepkgs, --replacefiles, 以及 --oldpackage 效果相同
--replacefiles  即使要安装的包会取代别的已安装包的文件，也安装该包
--replacepkgs   即使包的部分内容已安装在系统里，也安装该包
--oldpackage    允许用旧版本的包取代较新的版本
--prefix        指定安装路径
```



### 查询软件包

rpm 查询命令格式如下:
```bash
rpm -q [query-options] <package_file>
```

查询选项:
```bash
指定软件包的查询选项
<package_name>       查询软件包 <package_name>
-p <package_file>    查询一个没有安装的包
-a                   查询所有安装的包
-f <file>            查询拥有文件 <file> 的包

指定信息的查询选项
-i    展示包信息，包括名字，版本，以及描述
-R    列出该包所依赖的别的包
-l    列出该包的文件
-c    只列出配置文件

--last       按包的安装时间进行排序，这使得最新的包在序列顶部
--scripts    查看与软件包有关的脚本
```



### 校验软件包

校验软件包：
```bash
rpm -Va  #校验系统中已安装的所有软件包
rpm -V httpd  #校验 httpd
rpm -Vf /etc/httpd/conf/httpd.conf  #校验单个文件
```



软件包所拥有的每个文件都与保存在 RPM 数据库中的属性进行比较，结果分为以下 3 部分：

1、最前面的 8 个字符（S.5....T）都属于验证信息，各字符的具体含义如下：

```
  S    大小
  M    权限
  5    MD5值
  D    设备的主从代码是否改变
  L    文件路径是否改变
  U    所有者
  G    所属组
  T    修改时间
  .    相关项没有发生改变
  ?    表示由于权限问题等原因，验证没能执行
```

2、被修改文件类型，大致可分为以下几类：

```
  c    配置文件（configuration file）
  d    普通文档（documentation）
  g    "鬼"文件（ghost file），很少见，就是该文件不应该被这个 RPM 包包含
  l    授权文件（license file）
  r    描述文件（read me）
```

3、被修改文件所在绝对路径（包含文件名）。



### 数字签名

导入红帽的签名信息：
```bash
rpm --import /dvd/RPM-GPG-KEY-redhat-release #导入光盘的数字签名
rpm --import /etc/pki/rpm-gpg/RPM-GPG-KEY-CentOS-7 #导入系统默认的数字签名
```

数字签名安装完成后，可使用如下命令进行验证：
rpm -qa|grep gpg-pubkey

数字签名本身也是一个 RPM 包，可以查询与卸载。



### 无root权限安装 RPM 包

下面的命令可以把 RPM 包解压出来，放在当前的目录下。
```bash
rpm2cpio boost-regex-1.41.0-28.el6.x86_64.rpm | cpio -idmv
```

* `rpm2cpio` 命令用于将 RPM 包转换为 cpio 格式的文件；
* `cpio -idmv` 命令从包中提取文件，并在当前目录下生成相应文件夹。

`cpio` 部分选项：

```bash
  -i    从包中提取文件 (运行 copy-in 模式)
  -d    需要时创建目录
  -m    创建文件时保留以前文件的修改时间
  -v    详细列出已处理的文件
```

参考网站：  
[Linux rpm 命令参数使用详解](https://www.cnblogs.com/xiaochaohuashengmi/archive/2011/10/08/2203153.html)  
[Linux RPM包验证和数字证书](http://c.biancheng.net/view/820.html)  
[rpm - Linux Command](https://www.lifewire.com/rpm-linux-command-4093499)



## yum 软件包管理
### 配置文件

存放yum命令配置的文件地址： `/etc/yum.repos.d/*.repo`

```bash
[rhel]    ##仓库标识，不能重复
name=rhel 7    ##仓库描述信息，可以随便写
baseurl=http://......    ##指定仓库位置
enabled=1    ##启用该文件
gpgcheck=0    ##关闭检测软件包签名功能
gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-CentOS-7    #数字签名存放位置
```

快速配置：

```bash
yum-config-manager --add-repo http://...
```

列出仓库信息：

```bash
yum clean all  #清理缓存
yum repolist
```



### 查询软件

找出系统上已安装的包：

```
yum list installed
```

查询某个特定的安装包，如 tree：

```
yum list tree*
```

查询软件包的详细信息：

```
yum info [软件包]
```

查询提供该命令，文件的软件包名：

```bash
yum provides */pxelinux.0  #查询提供该命令的软件包名
yum provides `which vim`   #查询提供该文件的软件包名
```

按关键字查询软件包:

```
yum search [关键字]
```

查询软件包的库依赖关系：

```
yum deplist [软件包]
```



### 安装软件

```bash
yum -y install 软件  #安装软件 -y, --assumeyes 回答全部问题为是
```



### 更新软件

列出所有已安装软件包的可用更新：

```
yum list updates
```

更新软件：

```
yum -y update [软件]
```

更新所有软件：

```
yum update
```



### 卸载软件

删除软件而保留配置文件和数据文件：

```
yum remove [软件]
```

删除软件和它所有的文件：

```
yum erase [软件]
```

 

### 自定义 yum 仓库

```bash
createrepo /tools/other  #在目录下生成仓库信息的文件夹
```

参考网站：[Linux yum命令详解](http://c.biancheng.net/view/825.html)






