---
title: 浙大联网指南
categories: 技术
tags: 技术
---

* content
{:toc}
介绍不同的联网方式。



## VPN连接

要想台式机能够联网，通常需要使用浙大的VPN客户端。但这个客户端在使用上不是很人性化，尤其是在连接的时候，如果出现连接失败的情况，不能马上取消连接，要一直等到它报错了，才能进行下一次连接，因此平时连接时，需要花费比较长的时间，才能连上网。这里介绍一个使用Windows自带的VPN来联网的方法。使用这个方法联网，比用客户端高效很多。



### 添加VPN连接

打开 `Windows设置` 中的 `网络和Internet`

![vpn_1.png](/images/tech/network_connection/vpn_1.png)

在 `VPN` 中选择 `添加 VPN 连接`

![vpn_2.png](/images/tech/network_connection/vpn_2.png)

进行如下配置

![vpn_3.png](/images/tech/network_connection/vpn_3.png)

具体配置如下：

- VPN 提供商选择 Windows(内置)
- 连接名称可随意填写
- 服务器名称或地址填 `lns.zju.edu.cn`
- VPN 类型选择 自动
- 登录信息和类别选择 用户名和密码
- 用户名需要填写，填自己的学号
- 密码也需要填写



### 修改VPN属性

上一步点击保存之后，会回到 VPN 页面，点击 `更改适配器选择`

![vpn_4.png](/images/tech/network_connection/vpn_4.png)

此时会打开如下的界面

![vpn_5.png](/images/tech/network_connection/vpn_5.png)

右击刚刚创建的VPN连接，选择 `属性`，进入 `安全` 进行配置，需要选择图中红色方框内选项

![vpn_6.png](/images/tech/network_connection/vpn_6.png)



### 连接VPN

点击任务栏右下角的网络图标，就可以看到新建的VPN，在这里就能方便快捷地联网了

![vpn_7.png](/images/tech/network_connection/vpn_7.png)

需要注意的是，第一次连接可能会失败，会有一些奇怪的报错，比如：

![vpn_8.png](/images/tech/network_connection/vpn_8.png)

这时候重新连接几次，可能就成功了

另外，如果出现 “正在连接到 lns.zju.edu.cn” 这样的信息，可以直接点击取消，因为出现这样的信息是肯定连接不上的

![vpn_9.png](/images/tech/network_connection/vpn_9.png)

如果出现 “正在验证你的登录信息”，则这次连接肯定成功

![vpn_10.png](/images/tech/network_connection/vpn_10.png)



## 断网自动重拨

有时网络会意外断开，我们可以通过创建计划任务，在网络断开时自动重新连接。

### 创建计划任务

右击任务栏左下角的windows图标，再选择 `计算机管理`

![task_1.png](/images/tech/network_connection/task_1.png)

选择 `任务计划程序库`，点击右侧的 `创建基本任务`

![task_2.png](/images/tech/network_connection/task_2.png)

给这个计划任务取一个名称：

![task_3.png](/images/tech/network_connection/task_3.png)

在 `触发器` 中选择 `当特定事件被记录时`：

![task_4.png](/images/tech/network_connection/task_4.png)

`日志`，`源`，`事件ID` 按下图填写：

![task_5.png](/images/tech/network_connection/task_5.png)

`操作` 选择 `启动程序`：

![task_6.png](/images/tech/network_connection/task_6.png)

输入 `rasdial "ZJUVPN" 21816092 password`

- rasdial 是一个拨号的命令
- "ZJUVPN" 是创建的VPN连接的名称
- 21816092 改成自己的学号
- password 改成自己的密码

另外，需要注意的是，必须存在一个名为 `ZJUVPN` 的VPN连接，这个命令才能执行成功。

![task_7.png](/images/tech/network_connection/task_7.png)

选择 `是`：

![task_8.png](/images/tech/network_connection/task_8.png)

点击 `完成`：

![task_9.png](/images/tech/network_connection/task_9.png)

此时网络断开后，联网的命令会自动执行，但就像我们点击VPN联网一样，使用这个命令也可能会出现联网失败的情况。尽管在这个计划任务的属性中，我们可以设置任务失败后重新启动，但在实际使用时，重新启动就从来没有生效过。所以为了提高联网的成功率，我们还是要进行额外的设置。



### 使用bat脚本联网

上面讲到，单纯使用计划任务的命令不能保证每次联网都能成功，因此，我们可以利用批处理脚本来实现联网。实现的脚本如下：

```batch
:loop
rasdial ZJUVPN 21816092 password
if %errorlevel% == 0 goto label
goto:loop

:label
ipconfig > "D:\OneDrive - zju.edu.cn\11_connect\Dell-ip.txt"
```

第一行和第四行的 `loop` 和 `goto` 实现循环的功能。第二行是拨号的命令，该命令的解释见上文。第三行对拨号命令的执行结果进行判断，如果执行成功，跳到第六行执行；如果失败，则继续拨号。第七行的命令是将当前的IP地址等信息写入到文件中，具体的作用可以看我的下一篇博客：[浙大远程指南](/2020/06/07/浙大远程指南/)。

创建一个名为 `auto_connect.bat` 的文件（只有扩展名是 `bat` 就可以），复制粘贴上面的代码，保存后双击这个文件，就可以实现联网了。

接下来，还是需要将这个脚本添加到上面的计划任务中，以达到断网重拨的目的。

右击刚刚创建的计划任务，点击属性，在 `操作` 中，新建一个操作：

![task_10.png](/images/tech/network_connection/task_10.png)

选择批处理脚本：

![task_11.png](/images/tech/network_connection/task_11.png)

到现在，断网自动重拨的功能才算真正实现了。虽然配置有些麻烦，但在实际使用中的效果还是非常好，只要不是网线被拔，都能很快地恢复联网。



## 开机自动连接VPN

### 来电自动开机

由于浙大断电太过频繁，我们可以在电脑的BIOS中设置来电后电脑自动开机。

进入BIOS的方法，是在开机时按 `F2` 或 `F10` 或 `F12`，具体按哪个键，不同电脑品牌是不一样的，这个百度一下就可以了。

进入BIOS后，里面的界面也是不同的，要设置来电自动开机的话，一般要找到带有 "Power" 的设置项，这个具体如何设置，也可以去百度一下。下面是我自己电脑的设置方式：

![power_1.png](/images/tech/network_connection/power_1.png)

设置中有三个选项，含义如下：

- `Power Off` 是默认的选项，表示来电时不进行任何操作
- `Power On` 是来电时开机
- `Last Power State` 恢复断电前的状态，如果断电前电脑是开着的，那么来电后电脑会自动打开；但如果断电前电脑是关机的，来电后电脑也不会自动开启



### 开机自动拨号

设置开机自动拨号的方法和上面断网自动重拨的方法类似，只不过要在创建任务时把 `触发器` 改为 `计算机启动时`：

![task_12.png](/images/tech/network_connection/task_12.png)

另外，最好在属性中设置 `延迟任务时间`:

![task_13.png](/images/tech/network_connection/task_13.png)



