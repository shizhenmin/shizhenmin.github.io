---
title: Python logging模块
categories: python
tags: python
---

* content
{:toc}
## 基本概念

### 日志级别

日志的级别如下：

| 级别     | 数值 |
| -------- | ---- |
| CRITICAL | 50   |
| ERROR    | 40   |
| WARNING  | 30   |
| INFO     | 20   |
| DEBUG    | 10   |
| NOTSET   | 0    |



### 记录器对象

记录器对象 `Logger` 主要有3方面的功能。

Logger 的方法可以大致分为两类：配置和传输信息。

配置的方法主要有：

- `Logger.setLevel()` 
- `Logger.addHandler()` 和 `Logger.removeHandler()`
- `Logger.addFilter()` 和 `Logger.removeFilter()`



### 处理器对象



### 格式器对象





## 简单使用

#### 一个简单的例子

```python
import logging
logging.debug('Debug message!')
logging.info('Info message!')
logging.warning('Warning message!')
logging.error('Error message!')
logging.critical('Critical message!')
```

运行上面的代码，会输出：

```plaintext
WARNING:root:Warning message!
ERROR:root:Error message!
CRITICAL:root:Critical message!
```

因为默认级别是 WARNING。

<br>

#### 设置日志级别

```python
logging.basicConfig(level=logging.INFO)
```

设置级别后，日志级别高于这个的信息会被输出。

<br>

#### 使用变量设置日志级别

```python
import logging
loglevel = 'debug'
numeric_level = getattr(logging, loglevel.upper(), None)
if not isinstance(numeric_level, int):
    raise ValueError('Invalid log level: %s' % loglevel)
logging.basicConfig(level=numeric_level)
logging.debug('Debug message!')
```

将日志级别设置为 DEBUG。也可以在命令行参数中把日志级别传给变量 loglevel，从而在命令行中控制日志级别。

<br>

#### 输出到文件

```python
import logging
logging.basicConfig(filename='example.log', level=logging.DEBUG)
logging.debug('Debug message!')
```

将 logging 信息输出到 example.log 文件中。

<br>

#### 文件模式

```python
logging.basicConfig(filename='example.log', filemode='w', level=logging.DEBUG)
```

<br>

#### 多模块使用logging

myapp.py 文件：

```python
# myapp.py
import logging
import mylib

def main():
    logging.basicConfig(level=logging.INFO)
    logging.info('Started')
    mylib.do_something()
    logging.info('Finished')

if __name__ == '__main__':
    main()
```

mylib.py 文件：

```python
# mylib.py
import logging

def do_something():
    logging.info('Doing something')
```

运行 myapp.py，输出结果为：

```plaintext
INFO:root:Started
INFO:root:Doing something
INFO:root:Finished
```





### 基本配置

在实例化 logger 前，可以通过 `logging.basicConfig(**kwargs)` 对 logging 进行一次性配置：

```python
logging.basicConfig(level=logging.INFO)
```

这里将 level 设置为 INFO，意思为会输出级别高于 INFO 的信息。

支持以下关键字参数：

| 格式     | 描述                                                         |
| -------- | ------------------------------------------------------------ |
| filename | 使用指定的文件名而不是 StreamHandler 创建 FileHandler。      |
| filemode | 如果指定了 filename，则用此 模式 打开该文件。 默认模式为 `'a'`。 |
| format   | 处理器使用的指定格式字符串。                                 |
| datefmt  | 使用指定的日期/时间格式，与 `time.strftime()` 所接受的格式相同。 |
| style    | 如果指定了 format，将为格式字符串使用此风格。 `'%'`, `'{'` 或 `'$'` 分别对应于 printf 风格, `str.format()` 或 `string.Template`。 默认为 `'%'`。 |
| level    | 设置根记录器级别去指定 level.                                |
| stream   | 使用指定的流初始化 StreamHandler。 请注意此参数与 filename 是不兼容的 - 如果两者同时存在，则会引发 `ValueError`。 |
| handlers | 如果指定，这应为一个包含要加入根日志记录器的已创建处理程序的可迭代对象。 任何尚未设置格式描述符的处理程序将被设置为在此函数中创建的默认格式描述符。 请注意此参数与 filename 或 stream 不兼容 —— 如果两者同时存在，则会引发 `ValueError`。 |
| force    | 如果将此关键字参数指定为 true，则在执行其他参数指定的配置之前，将移除并关闭附加到根记录器的所有现有处理器。 |

也可以在实例化之后，对每个实例进行单独设置。



### 实例化

使用 `logging.getLogger()` 来实例化 logger

```python
logger = logging.getLogger(logger_name)
```

如果不给定 `logger_name`，则会用 `root` 作为名字。

为实例化的 logger 设置日志等级：

```python
logger.setLevel(logging.INFO)
```



### 格式化

可以在 `basicConfig` 中进行输出结果的格式化：

```python
logging.basicConfig(level = logging.DEBUG, format = '%(asctime)s - %(name)s - %(levelname)s - %(message)s')
```

也可以使用格式化器：

```python
formatter = logging.Formatter('%(asctime)s - %(name)s - %(levelname)s - %(message)s')
handler.setFormatter(formatter)
```

这里的 `handler` 是处理器实例。

可用的属性名称：

| 属性名称        | 格式                | 说明                                                        |
| --------------- | ------------------- | ----------------------------------------------------------- |
| name            | %(name)s            | 日志的名称                                                  |
| asctime         | %(asctime)s         | 可读时间，默认格式‘2003-07-08 16:49:45,896’，逗号之后是毫秒 |
| filename        | %(filename)s        | 文件名，pathname的一部分                                    |
| pathname        | %(pathname)s        | 文件的全路径名称                                            |
| funcName        | %(funcName)s        | 调用日志多对应的方法名                                      |
| levelname       | %(levelname)s       | 日志的等级                                                  |
| levelno         | %(levelno)s         | 数字化的日志等级                                            |
| lineno          | %(lineno)d          | 被记录日志在源码中的行数                                    |
| module          | %(module)s          | 模块名                                                      |
| msecs           | %(msecs)d           | 时间中的毫秒部分                                            |
| process         | %(process)d         | 进程的ID                                                    |
| processName     | %(processName)s     | 进程的名称                                                  |
| thread          | %(thread)d          | 线程的ID                                                    |
| threadName      | %(threadName)s      | 线程的名称                                                  |
| relativeCreated | %(relativeCreated)d | 日志被创建的相对时间，以毫秒为单位                          |

#### 设置时间格式

```python
logging.basicConfig(format='%(asctime)s %(message)s', datefmt='%Y-%m-%d %H:%M:%S')
```





## 写入文件

### 将日志写入到文件

使用 `FileHandler` 将输出指定到文件中：

```python
handler = logging.FileHandler('log.txt', 'w')
handler.setLevel(logging.INFO)
logger.addHandler(handler)
```



```python
logger.error("Error!", exc_info = True)
```



### 同时输出到屏幕和文件

在上面的基础上，再加上 `StreamHandler`：

```python
console = logging.StreamHandler()
logger.addHandler(console)
```



## 实例

### 不同级别的日志信息写入到不同文件

参考：[Python--logging模块不同级别写入到不同文件](https://www.cnblogs.com/yanjieli/p/10179626.html)



### 不同级别的日志信息用不同的格式输出



参考：

<https://docs.python.org/3/howto/logging.html#logging-levels>







