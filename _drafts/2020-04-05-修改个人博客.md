---
title: 修改个人博客
categories: 技术
tags: 教程 博客 jekyll
---

* content
{:toc}
这次修改，主要是增加了显示代码行号和博客全文搜索的功能。另外我还对网站的样式进行了一些细微的调整，这些修改在 [搭建个人博客](/2020/02/22/搭建个人博客/) 中没有提到，因此索性在这篇文章里把修改过的地方记录下来。



## 显示代码行号

### Prism 简介

Prism 是一个轻量级的、可扩展的语法高亮插件，除支持各种主流语言的语法高亮外，还有显示行号等功能。使用也非常简单，在页面中引入 `prism.css` 和 `prism.js` 就能使用了。



### 下载代码

直接从 [官网下载页面](http://prismjs.com/download.html) 下载 `prism.css` 和 `prism.js`。在官网中可以选择高亮主题(Themes)，支持的语言Languages)，和额外的功能(Plugins)。我自己勾选了显示行号(Line Numbers)和显示语言(Show Language)这两个插件。



### 引入css

将下载的 `prism.css` 放到 `_sass` 文件夹，然后在 `css\main.scss` 中引入 `prism.css`：

```
@import "prism";
```

我改了字体大小、行高等细节，这里就不把修改的地方贴上来了。



### 引入js

将下载的 `prism.css` 放到 `_sass` 文件夹，然后在 `_layouts\default.html` 中引入 `prism.css`：

```
<script src="{{ site.baseurl }}/js/prism.js"></script>
```

还需要给 pre 标签（或其父标签）的 class 属性添加 line-numbers 值，让其显示行号，[这篇教程](<https://blog.csdn.net/u013961139/article/details/78853544>)中说可以使用下面的代码：

```html
<script type="text/javascript">
  $('pre').addClass("line-numbers").css("white-space", "pre-wrap");
</script>
```

但不知道为什么我这里不行，所以我就直接给整个 body 标签的 class 属性加上了 line-numbers。

另外现在我的博客还有一个特性，就是不给代码块指定语言时，是不会显示行号的。这个特性还挺有用的，所以它不是一个BUG，真的。



## 全文搜索

### Simple-Jekyll-Search 简介

[Simple-Jekyll-Search](<https://github.com/christian-fei/Simple-Jekyll-Search>) 这个插件能生成全部文章的索引，通过 JavaScript 脚本，实现对博客的全文搜索。



### 根目录中新建 search.json 文件

如果把这个文件的代码贴到文章里的话，会导致文章显示异常，因此这里就不把代码贴出来了。大家可以从我的 github 项目中下载这个文件。

值得一提的是，文章中如果有反斜线 `\` 或制表符，生成的索引文件就会有语法错误，导致搜索失败。我参考了网上的一些教程，但没有成功，最后用了 [replace](https://shopify.github.io/liquid/filters/replace/) 将反斜线 `\` 或制表符替换成空字符。



### 添加 JavaScript 脚本

将 `simple-jekyll-search.js` 放到 `js/` 目录中。这个脚本比较长，代码我也不放了。大家可以从 [Simple-Jekyll-Search](<https://github.com/christian-fei/Simple-Jekyll-Search>) 或者我的 github 项目中下载这个文件。



### 添加搜索框

在导航栏添加搜索框，需要在 `_includes/header.html` 中加入以下代码：

```html
<li id="search-container">
    <input type="text" id="search-input" placeholder="search...">
    <ul id="results-container"></ul>
</li>
```



### 添加搜索代码

上一步的代码只是增加了一个搜索框，还不能实现搜索功能，还需要在 `_layouts/default.html` 中加入 JavaScript 代码：

```html
<script src="{{ site.baseurl }}/js/simple-jekyll-search.js"></script>

<script>
  window.simpleJekyllSearch = new SimpleJekyllSearch({
    searchInput: document.getElementById('search-input'),
    resultsContainer: document.getElementById('results-container'),
    json: '{{ site.baseurl }}/search.json',
    searchResultTemplate: '<li class="search-result"><a class="search-result" href="{url}?query={query}" title="{desc}" target="_blank">{title}</a></li>',
    noResultsText: 'No results found',
    limit: 10,
    fuzzy: false,
    exclude: ['Welcome']
  })
</script>
```



### 设置css样式

最后是修改css样式，让搜索框与导航栏的风格统一。在 `_sass/_header.scss` 中加入：

```css
#search-input {
    width: 200px;
    height: 52px;
    border: none;
    color: #ddd;
    background-color: rgba(255,255,255,.08);
    line-height: 35px;
    padding:0px 16px;
    font-size: 16px;
    font-weight: bold;
    outline: none;
    box-sizing: border-box;
    box-shadow: inset 0 1px 1px rgba(0,0,0,.075), 0 0 8px rgba(102,175,233,.6);
    &:hover,&:focus {
        background-color: rgba(255,255,255,.1);
    }
}
#results-container{
    display: none;
}
#search-input:focus + #results-container, #results-container:hover{
    position: absolute;
    display: block;
    .search-result {
        display: block;
        background-color: rgba(44,44,44,.8);
        &:hover {
            background-color: #222;
        }
        a,a:hover {
            color: #ddd;
        }
    }
}
```



## 新标签页打开文章

在原博客中，点击某一篇文章，会在当前页面打开这篇文章。我不太习惯这样的设定，因此希望点击文章时，能在新标签页打开文章，而原来的页面不受影响。可以在 html 文件的的 `<a>` 标签中加入 `target="_blank"` 属性，来实现这样的目的：

```
<a target="_blank" href=""></a>
```

我总共修改了 `index.html`、`_includes/category.html` 和 `_includes/tag.html` 这3个文件。



## 设置网页宽度

在半屏浏览博客时，总觉得页面左右两边空着的地方太大了。所以把：

```css
@media screen and (max-width:1200px) and (min-width: 770px) {
    .page {
        width: 90%;
    }
}
```

改为了：

```css
@media screen and (max-width:1200px) and (min-width: 770px) {
    .page {
        width: 95%;
    }
}
```



## 参考

* [使用prismjs实现Jekyll代码语法高亮并显示行号](<https://blog.csdn.net/u013961139/article/details/78853544>)

* [Prism Line-Numbers 的介绍](https://prismjs.com/plugins/line-numbers/)

* [Simple-Jekyll-Search 的github官网](https://www.npmjs.com/package/simple-jekyll-search)

* [为Jekyll+GitHub Pages添加全文搜索功能](<https://www.bbsmax.com/A/MyJxeEEE5n/>)

