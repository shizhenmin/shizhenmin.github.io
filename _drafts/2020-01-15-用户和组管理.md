---
title: Linux用户和组管理
categories: Linux
tags: Linux命令 CentOS
---

* content
{:toc}

## 概念
### 用户
UNIX 系统有三种用户： 超级用户、系统用户和普通用户。


### UID
UID 为 0 ～ 65535 之间的数字，表示不同的用户。

  • 0  root
  • 1～499  系统用户
  • 500～65535  普通用户




## 相关文件
### /etc/passwd
每一行有 7 个用冒号分开的字段。
1. 用户名  
2. 密码占位符  该字段显示 x ，表示密码是加密的；如果该字段为空，表示不需要密码就能登录
3. UID  
4. 基本组ID  
5. 描述信息  
6. home目录  
7. 解释器  /sbin/nologin 表示该用户不能登录



### /etc/shadow

每一行有 9 个用冒号分开的字段。
1. 用户名  
2. 加密后的密码  没有设置密码时，密码字段显示为 !!
3. 自1970-01-01到上一次修改密码的天数  
4. 密码最少使用天数  
5. 密码最多使用天数  
6. 提前几天通知改密码  
7. 密码过期后失效的天数  
8. 账户过期的天数（自1970-01-01）  
9. 保留字段，目前为空



### /etc/group

1. 组名  
2. 密码  
3. GID  
4. 组内用户列表  



### /etc/gshadow

保存 group 的密码等信息。



### /etc/default/useradd

改文件保存创建用户时的默认设置。可以使用命令 `useradd -D` 进行修改，也可以通过vim修改。

```bash
GROUP=100    #该选项并不生效
HOME=/home    #用户默认home目录
INACTIVE=-1    #密码过期后失效的天数，/etc/shadow 第7列，-1表示不失效
EXPIRE=    #账户过期的天数
SHELL=/bin/bash    #默认shell
SKEL=/etc/skel    #默认从该目录内复制配置文件
CREATE_MAIL_SPOOL=yes    #默认在/var/spool/mail/下创建邮箱
```



### /etc/login.defs

改文件保存创建用户时的默认设置。



## 命令

### useradd
`useradd` 命令用于创建用户。

```bash
  -d    homedir （家目录）
  -m    创建用户主目录
  -s    loginShell （登录Shell） /sbin/nologin  禁止用户登录系统
  
  -c    "comment（备注）"
  -e    expireDate （有效期）
  -g    primaryGroup （主要组）
  -G    group1,group2,... 
  -u    userid
  -r, --system
           Create a system account
```

创建用户时，会进行以下操作：
* 分配新的 UID
* 在 `/etc/passwd` 中添加一行
* 在 `/etc/shadow` 中添加一行
* 在 `/etc/group` 中为用户建立一个新的个人组
* 在 `/etc/gshadow` 中添加信息
* 为用户建立一个新的家目录
* 将 `/etc/skel` 中的文件复制到家目录，如 `.bashrc` 和 `.bash_profile`



### id
`id` 命令用于查看用户信息。


### usermod
`usermod` 命令用于修改用户属性。

```bash
  -L     （禁止用户登录）
  -U     （反转-L的效果，让用户可以登录）

  -c     "comment（备注）"
  -d     homedir （家目录）
  -e     expireDate （有效期）
  -g     primaryGroup （主要组）
  -G     group1,group2,... （附加组）使用usermod加入新组时，原来的组也要写上 
  -s     loginShell （登录Shell） /sbin/nologin  禁止用户登录系统
  -l     newUsername （新用户名）
  -u     newUserid （新userid）
```



### userdel

`userdel` 命令用于删除用户。



### passwd

`passwd` 命令用于设置或更改密码。

非交互式修改密码：
```bash
echo 123456 | passwd --stdin shizhenmin
```

部分选项：

```bash
  -l    禁止用户登录
  -u    反转-l的效果，让用户可以登录
  
  -S    查询用户密码的状态，即 /etc/shadow 文件中此用户密码的内容。仅 root 用户可用
```



### chpasswd

`chpasswd` 命令能从标准输入自动读取 **登录名** 和 **密码** （由冒号分割），给密码加密，然后为用户账户设置：

```bash
echo username:passwd | chpasswd
```

也可以用重定向命令来将含有 `username:passwd` 的文件重定向给该命令：

```bash
chpasswd < users.txt
```



### chage

`chage` 命令用于查看或设置用户密码时效的具体信息。

```bash
  -l    列出密码时效的具体信息
  -d    YYYY-MM-DD 人工设定上一次更改密码的日期
  -m    mindays Last Day后再次更改密码的最少天数
  -M    maxdays Last Day后再次更改密码前使用密码的最多天数（Maximun Day）
  -W    warndays Maximun Day前收到警告的天数
  -I    inactivedays Maximun Day后密码过期的天数
  -E    YYYY-MM-DD 设定账户（不是密码）过期的日期
```

强制用户 user 登录后修改密码：

```bash
chage -d 0 user
```



### groups

`groups` 命令用于查看用户所属的组。



### groupadd

`groupadd` 命令用于建立一个新的组。

```bash
  -g    指定GID
```



### groupmod

```bash
  -g    指定新的GID
  -n    指定新的组名
```



### groupdel

`groupdel` 命令用于删除一个组。



### gpasswd

`gpasswd` 命令用于从组中增加或删除用户。

```bash
gpasswd -a 用户名 组名  ##将用户添加到组中
gpasswd -d 用户名 组名  ##将用户从组中删除
```



### newgrp

`newgrp` 命令用于改变有效组。

命令格式： `newgrp [group]`



### su

`su` 命令用于切换用户身份。

`su` 与 `su -` 的区别：使用 - 会在切换用户的同时改变所在目录和环境变量。



### whoami

`whoami` 命令用于显示有效用户（EUID，即 Effective UID），在用 `su` 命令切换用户后，显示的是切换之后的用户。



### who am i

`who am i` 命令用于显示实际用户（UID），在用 `su` 命令切换用户后，显示的还是切换之前的用户。