---
title: Python logging模块
categories: python
tags: python
---

* content
{:toc}
## 安装

```
pip3 install pytest
```

安装 html 支持

```bash
pip3 install pytest-html
```





## 简单使用

创建名为 test_func.py 的脚本：

```python
def add(x, y):
    return x + y

def test1():
    assert 3 == add(1, 1)

def test2():
    assert 1 != add(1, 1)
```

运行：

```bash
pytest -v test_func.py
pytest  # 执行目录下的所有 test_*.py 脚本
```

计算测试时间：

```bash
pytest --v --duration=0 test_func.py
```



### 测试异常

```python
import pytest

def func(x):
    if x == 0:
        raise ValueError("value error!")
    else:
        pass

def test_mytest1():
    with pytest.raises(ValueError):
        func(0)

def test_mytest2():
    assert func(1) == None
```



### 不同参数传递测试

```python
import pytest

def add(x, y):
    return x + y

@pytest.mark.parametrize(
    "x, y, expected",
    [
        (1, 1, 2),
        (2, 2, 4),
        (10, 10, 20),
    ]
)

def test_add(x, y, expected):
    assert add(x, y) == expected
```



### 分组测试

将测试方法分为不同测试组，测试时可以单独测试某个组的方法。

创建名为 pytest.ini 的文件：

```ini
[pytest]
markers = 
    g1: group1.
    g2: group2.
```

python 脚本：

```python
import pytest

@pytest.mark.g1
def test_func1():
    pass

@pytest.mark.g2
def test_func2():
    pass

@pytest.mark.g1
def test_func3():
    pass

@pytest.mark.g2
def test_func4():
    pass

@pytest.mark.g1
def test_func5():
    pass
```

运行：

```bash
pytest -vv .\test_func.py
pytest -vv -m g1 .\test_func.py
pytest -vv -m g2 .\test_func.py
```



## 执行测试

```bash
pytest
pytest -s  # 打印print的输出内容
pytest -v  # 更详细的输出信息
pytest --html=report.html --self-contained-html  # 输出单个html
```





参考：

[基于Pytest框架的自动化测试开发实践（万字长文入门篇）](https://mp.weixin.qq.com/s?__biz=MzI4MjcwNTU1MQ==&mid=2247483856&idx=1&sn=937841e57c77c3686ce2644367aa5248&chksm=eb94aa30dce32326b1e46efe63a1146d4d492b754d684135cf3026b26a30d5cb214ac3443a75&scene=158#rd)

[【Python】pytest - 自动化测试工具, 帮你写出最好的程序](https://www.bilibili.com/video/BV1J441177xm?from=search&seid=9619818040034290145)

[pytest 自动化测试框架 - unittest 升级版](https://www.bilibili.com/video/BV1bV41167a4)









